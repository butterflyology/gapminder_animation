---
title: "`gganimate`"
author: "Chris Hamm"
date: "`r Sys.Date()`"
output: 
 # pdf_document:
 #   toc: true
 #   number_sections: true
 #   fig_caption: yes
  html_document:
    toc: TRUE
    toc_float: TRUE
    toc_depth: 3
---


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", cache = TRUE)
options(dplyr.width = Inf)
```

# Introduction

This tutorial goes through the fundamentals of the `gganimate` pacakge. This is an intermediate level workshop and assumes that learners are familiar with the "grammar of graphics" as implemented in `ggplot2`.

`gganimate` creates animated figures by transitioning plots through different "states."

The key is to think about what you want your plot to do and then iteratively build your animation.

The key argument in `ggaminate` is the `transition` function.


We'll start with a few `R` preliminaries





```

# Easing

`gganimate` calculates intermediate ("tween") values to transition among states. You can decide how this process occurs, which is called *easing* and can be adjusted with `ease_aes()`.

`ease_aes('linear')`:

  - **quadratic**: \( x^2 \) 
  - **cubic**: \( x^3 \)
  - **quartic**: \( x^4 \)
  - **quintic**: \( x^5 \)
  - **sine**: \( \sin(x) \)
  - **circular**: \( \frac{\pi}{2} \)
  - **exponential**: \( x^e \)
  - **elastic**: elastic release of energy
  - **back**: pullback and release
  - **bounce**: bouncing ball
    - *methods*
      - **-in** - function applied "as-is"
      - **-out** - function applied in reverse
      - **-in-out** - first half applied "as-is", second half is reversed.
      

'cubic-in-out`
```{r irisEasing}
irisAnimation <- iris_plot +
  transition_states(Species,
                    transition_length = 2, 
                    state_length = 1) +
  labs(title = "Iris {closest_state}")

irisAnimation +
  ease_aes('cubic-in-out')
```


'bounce-out'
```{r irisBounceOut}
irisAnimation +
  ease_aes(y = "bounce-out")
```


# `enter_` & `exit_`

A few of the fine tuning functions work for both `transition_states()` and `transition_time()`. 

Specifically we will deal with `enter_` and `exit_`. Each can be paired with a variety of behaviors such as:

  - `appear` / `disappear` - make elements appear and disappear at the start or end of their transition.
  - `fade` - set `alpha` value to make elements fade in / fade out during transitions.
  - `grow` / `shrink` - set elements to make them grow into or shrink out during their transition
  - `recolor` - gradually change color or fill elements from their defined color to new color
  - `fly` - set `x` and `y` positions where all elements enter from / exit to
  - `drift` - modify the position of an element by a specified amount

Each has additional customizable parameters. 


A bit abrupt to plot `color = Species` as such.

## Colors
```{r irisColors}
iris %>% 
  ggplot(aes(x = Petal.Width, y= Petal.Length)) +
  geom_point(aes(color = Species), size = 5, alpha = 0.75, show.legend = FALSE) +
  labs(x = "Petal width", y = "Petal length") +
  transition_states(Species,
                    transition_length = 2, 
                    state_length = 1,
                    ) +
  labs(title = "Iris {closest_state}")
```


Smooth the transition between distinct states with `enter_fade()` and `exit_fade()`.

```{r irisColors2}
iris %>% 
  ggplot(aes(x = Petal.Width, y= Petal.Length)) +
  geom_point(aes(color = Species), size = 5, alpha = 0.75, show.legend = FALSE) +
  labs(x = "Petal width", y = "Petal length") +
  transition_states(Species,
                    transition_length = 2, 
                    state_length = 1,
                    ) +
  labs(title = "Iris {closest_state}") +
  enter_fade() +
  exit_fade()
```


Or, set them with one group with `1L`:
```{r irisSmoothColor}
iris %>% 
ggplot(aes(x = Petal.Width, y = Petal.Length)) + 
  geom_point(aes(colour = Species, group = 1L), size = 5, alpha = 0.75, show.legend = FALSE) +
  labs(x = "Petal width", y = "Petal length") +
  transition_states(Species,
                    transition_length = 2,
                    state_length = 1) +
  labs(title = "Iris {closest_state}")
```


# `transition_time()`
Let's use with the `gapminder` data and try to recreate the Rosling plots.

```{r gapMinder}
data(gapminder)
glimpse(gapminder)
```


```{r gapminderStatic}
gap_plot <- gapminder %>% 
  ggplot(
    aes(x = gdpPercap, y = lifeExp, size = pop, color = country)) +
  geom_point(show.legend = FALSE, alpha = 0.7) +
  scale_color_viridis_d() +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  labs(x = "GDP per capita", y = "Life expectency")
gap_plot
```


```{r gapTime}
gap_plot +
transition_time(year) +
  labs(title = "Year: {frame_time}")
```


## `facet_wrap()`
```{r gapWrap}
gap_plot +
facet_wrap(~continent) +
  transition_time(year) + 
  labs(title = "Year: {frame_time}")
```


## `view_follow()`

`view_follow(fixed_x = FALSE, fixed_y = FALSE, exclude_layer = NULL, aspect_ratio = 1)`:

  - `fixed_x`: `
  - `fixed_y`:
  - `exclude`: a layer / indes
  - `aspect_ratio`: overrides any `fixed_`

I personally do not care for this in most situations I have encountered. If you find a good use case please let me know.

```{r gapFollow}
gap_plot + 
  transition_time(year) +
  labs(title = "Year: {frame_time}") +
  view_follow(fixed_y = TRUE)
```


## `shadow_wake()`

`shadow_wake(wake_length, size = TRUE, alpha = TRUE, colour = NULL, fill = NULL, falloff = "cubic-in", wrap = TRUE, exclude_layer = NULL, exclude_phase = c("enter", "exit"))`

```{r gapShadow}
gap_plot +
transition_time(year) +
  labs(title = "Year: {frame_time}") +
  shadow_wake(wake_length = 0.1, alpha = TRUE)
```


# `geom_boxplot()`

Start with our static plot
```{r boxStatic}
car_plot <- mtcars %>% 
  ggplot(aes(x = factor(cyl), y = mpg)) +
  geom_boxplot() +
  labs(y = "MPG", x = "Cylinders")
car_plot
```

Now create the animation:
```{r boxAnim}
car_plot +
  transition_states(gear, 
                    transition_length = 2, 
                    state_length = 1)
```


Let's set the fade in and out
```{r boxFade}
car_plot +
  transition_states(gear, 
                    transition_length = 2, 
                    state_length = 1) +
  enter_fade() +
  labs(title = "Gears: {closest_state}")
```


Multiple effects:
```{r boxEffects}
car_plot + 
  theme_minimal() +
  transition_states(gear, 
                    transition_length = 2, 
                    state_length = 1) +
  labs(title = "Gears: {closest_state}") +
  enter_fade() + 
  enter_grow() +
  exit_fly(x_loc = 7, y_loc = 40) + 
  exit_recolour(fill = 'forestgreen')
```


# `geom_line()`

How to create an animated line plot 
```{r airQuality}
data(airquality)
glimpse(airquality)
range(airquality$Month)
```


Set the static plot:
```{r airPlot}
air_plot <- airquality %>% 
  ggplot(
    aes(x = Day, y = Temp, group = Month, color = factor(Month))
  ) +
  geom_line() +
  scale_color_viridis_d(name = "Month") +
  labs(x = "Day of Month", y = "Temperature") +
  theme(legend.position = "top")
air_plot
```


Extend lines by day across months
```{r airAnim}
air_plot +
  transition_reveal(Day)
```


Add points to the plot to draw the eye
```{r airLinePoint}
air_plot +
  geom_point() +
  transition_reveal(Day)
```


# `geom_point()`

Create the static plot
```{r airPoint}
air_point <- airquality %>% 
  ggplot(aes(x = Day, y = Temp, group = Month, color = factor(Month))) +
  geom_point() +
  scale_color_viridis_d(name = "Month") +
  labs(x = "Day of Month", y = "Temperature") +
  theme(legend.position = "top")
air_point
```


```{r airWake}
air_point + 
  transition_reveal(Day) +
  shadow_wake(wake_length = 1, alpha = TRUE, size = TRUE)
```


```{r}
air_point +
  geom_point(aes(group = seq_along(Day))) +
  transition_reveal(Day)
```


# `geom_col()`

Summarize the `airquality` data and make a bar chart

```{r airMean}
mean_temp <- airquality %>% 
  group_by(Month) %>% 
  summarize(mTemp = mean(Temp))
mean_temp
```

Create the static plto
```{r meanStatic}
temp_plot <- mean_temp %>% 
  ggplot(
    aes(x = Month, y = mTemp, fill = mTemp)) +
  geom_col() +
  scale_fill_distiller(palette = "Reds", direction = 1, name = "Temp") +
  theme_minimal() +
  labs(y = "Mean temperature", x = "Month") +
  theme(
    panel.grid = element_blank(),
    panel.grid.major.y = element_line(color = "white"),
    panel.ontop = TRUE)
temp_plot
```


```{r meanAnim}
temp_plot +
  transition_states(Month, wrap = FALSE)
```


Add some effects:
```{r meanEffect}
temp_plot +
  transition_states(Month, wrap = FALSE) +
  shadow_mark() +
  enter_grow() + 
  enter_fade()
```

